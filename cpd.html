<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2015-11-30 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Winston &#x2013; CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20151130" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Winston
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2015-11-30</span>
                  &nbsp;| <span id="projectVersion">Version: 1.3.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="./" title="Winston">Winston</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                          <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                          <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
            <strong>CPD</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD">PMD</a>
            </li>
                      <li class="none">
                          <a href="findbugs.html" title="FindBugs">FindBugs</a>
            </li>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
                      <li class="none">
                          <a href="cobertura/index.html" title="Cobertura Test Coverage">Cobertura Test Coverage</a>
            </li>
                      <li class="none">
                          <a href="javancss.html" title="JavaNCSS Report">JavaNCSS Report</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section">
<h2><a name="CPD_Results"></a>CPD Results</h2>
<p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 5.3.2.</p></div>
<div class="section">
<h2><a name="Duplications"></a>Duplications</h2>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L537">537</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L663">663</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>					if (!filled)
					{
						d = new double[] { i, Integer.MAX_VALUE, Integer.MIN_VALUE, 0, 0 };
						winston.getStatement().execute(&quot;INSERT IGNORE INTO `&quot; + table + &quot;` VALUES (&quot; + i + &quot;,&quot; + Integer.MAX_VALUE + &quot;,&quot; + Integer.MIN_VALUE + &quot;,0,0)&quot;);
					}
				}
				heliList[j++] = d;
			}
			double st = tb.getStartTimeJ2K();
			double dt = 1 / tb.samplingRate();
			for (int i = 0; i &lt; tb.numSamples(); i++)
			{
				j = (int)(Math.floor(st) - fst);
				double[] d = heliList[j];
				int sample = tb.samples()[i];
				d[1] = Math.min(d[1], sample);
				d[2] = Math.max(d[2], sample);
				d[4] = (d[4] * d[3] + Math.abs(sample)) / (d[3] + 1);
				d[3] = d[3] + 1;
				st += dt;
			}

			for (int i = 0; i &lt; heliList.length; i++)
			{
				int j2k = (int)Math.round(fst + i);
				winston.getStatement().execute(&quot;UPDATE `&quot; + table + &quot;` SET smin=&quot; + (int)heliList[i][1] + &quot;, smax=&quot; + (int)heliList[i][2] + &quot;, rcnt=&quot; + (int)heliList[i][3] + &quot;, rsam=&quot; + heliList[i][4] + &quot; WHERE j2ksec=&quot; + j2k);
				opt.putData(j2k, heliList[i]);
			}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/tools/pannel/AdminPanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/AdminPanel.html#L36">36</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/tools/pannel/WinstonUpgradePanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/WinstonUpgradePanel.html#L37">37</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>		this.setBorder(BorderFactory.createTitledBorder(BorderFactory.createLineBorder(Color.black), &quot;Winston Admin&quot;));
		setLayout(new BoxLayout(this, BoxLayout.PAGE_AXIS));

		FormLayout layout = new FormLayout(
				&quot;left:p, 4dlu, fill:p:G&quot;,
				&quot;&quot;);

		DefaultFormBuilder builder = new DefaultFormBuilder(layout);
		builder.setDefaultDialogBorder();
		
		createFields();
		builder.append(&quot;Current schema&quot;, currentVersion);
		builder.nextLine();
		builder.append(&quot;Available upgrade&quot;, upgradeDescription);
		builder.nextLine();
		builder.appendUnrelatedComponentsGapRow();
		builder.nextLine();
		builder.append(&quot;&quot;, upgradeB);
	    add(builder.getPanel());
	}
	
	protected void createFields()
	{
		ug = new Upgrade();
		
		currentVersion = new JTextField(ug.getCurrentVersion());
		
		upgradeDescription = new JTextArea(ug.getUpgraderDescription());
		upgradeDescription.setLineWrap(true);
		upgradeDescription.setWrapStyleWord(true);
		
		upgradeB = new JButton(&quot;upgrade&quot;);
		upgradeB.setEnabled(ug.upgradeAvailable());
		upgradeB.addActionListener(new ActionListener(){
			public void actionPerformed(ActionEvent e) {
				start();
			}});
	}
	
	protected void go()
	{
		ug.doUpgrade();
		removeAll();
		createUI();
	}

	public boolean needsWinston() {
		return true;
	}
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L193">193</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/db/InputEW.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/InputEW.html#L179">179</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>					checkTableCache.remove(table);
					
					winston.getStatement().execute(&quot;DROP TABLE `&quot; + table + &quot;`&quot;);
					winston.getStatement().execute(&quot;DROP TABLE `&quot; + ss[0] + &quot;$$H&quot; + ss[1] + &quot;`&quot;);
					deleted = true;
					winston.getLogger().info(&quot;Deleted table: &quot; + table);
				}
				catch (Exception e)
				{
					winston.getLogger().severe(&quot;Could not drop old table: &quot; + channel + &quot;.  Are permissions set properly?&quot;);
				}
			}
			else
			{
				if (deleted)
				{
					try
					{
						String nextLowestTable = table;
						ResultSet rs = winston.getStatement().executeQuery(&quot;SELECT MIN(st) FROM `&quot; + nextLowestTable + &quot;`&quot;);
						rs.next();
						double t1 = rs.getDouble(1);
						setTimeSpan(channel, t1, Double.NaN);
						rs.close();
						setTime = true;
					}
					catch (Exception e)
					{
						winston.getLogger().severe(&quot;Could not update span after dropping table: &quot; + channel);
					}
				}
				break;
			}
		}
		if (deleted &amp;&amp; !setTime)
		{
			// must have deleted all of the tables, just delete the channel entirely
			winston.getLogger().info(&quot;Permanently deleting channel: &quot; + channel);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L505">505</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L636">636</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>			opt.t1 = Math.min(opt.t1, tb.getStartTimeJ2K());
			opt.t2 = Math.max(opt.t2, tb.getEndTimeJ2K());
			
			if (!writeLocks)
				setTimeSpan(code, opt.t1, opt.t2);
//			setTimeSpan(code, opt.t1, opt.t2);

			///----- now insert/update helicorder/rsam data
			table = code + &quot;$$H&quot; + date;
			double fst = Math.floor(tb.getStartTimeJ2K());
			double cet = Math.ceil(tb.getEndTimeJ2K());
			double[][] heliList = new double[((int)Math.round(cet - fst)) + 1][];
			int j = 0;
			for (int i = (int)Math.round(fst); i &lt;= (int)Math.round(cet); i++)
			{
				double[] d = opt.getData(i);
				if (d == null)
				{
					boolean filled = false;
					/*
					 // needed for static importer
					if (fillHeli)
					{
						ResultSet rs = winston.executeQuery(&quot;SELECT j2ksec, smin, smax, rcnt, rsam FROM &quot; + table + &quot; WHERE j2ksec=&quot; + i);
						if (rs.next())
						{
							filled = true;
							d = new double[] { rs.getDouble(1), rs.getDouble(2), rs.getDouble(3), rs.getDouble(4), rs.getDouble(5) }; 
						}
					}
					*/
					
					if (!filled)</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/server/cmd/GetSCNCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/cmd/GetSCNCommand.html#L43">43</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/cmd/GetSCNLCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/cmd/GetSCNLCommand.html#L42">42</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>		double t2 = Util.ewToJ2K(cmd.getT2(false));
		t2 = timeOrMaxDays(t2);
		
		double[] bounds = checkTimes(sid, t1, t2);
		if (!allowTransaction(bounds))
		{
			netTools.writeString(cmd.getEarthwormErrorString(sid, getError(bounds)), channel);
			return;
		}
		Wave wave = null;
		try{
			wave = data.getWave(sid, t1, t2, 0);
		} catch (UtilException e){
		}
		if (wave != null)
			totalBytes = writeWaveAsAscii(wave, sid, cmd.getID(), cmd.getS(), cmd.getC(), cmd.getN(), null, t1, t2, cmd.getString(7), channel);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/server/WWSClient.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/WWSClient.html#L271">271</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/WWSClient.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/WWSClient.html#L341">341</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>        Wave wave = winston.getWave(sta, comp, net, loc, st, et, false);

        if (wave != null) {
            wave = wave.subset(st, et);

            SeismicDataFile file = SeismicDataFile.getFile(fn, FileType.SAC);
            String channel = sta + &quot;_&quot; + comp + &quot;_&quot; + net;
            if (loc != null)
                channel += &quot;_&quot; + loc;

            file.putWave(channel, wave);
            try {
                file.write();
            } catch (IOException e) {
                System.err.println(&quot;Couldn't write file: &quot; + e.getLocalizedMessage());
                e.printStackTrace();
            }
        } else {
            System.out.println(&quot;Wave not found&quot;);
        }
    }

    public static void outputSac(String server, int port, Double st, Double et, String c, String fn, double gulpSize,</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/tools/pannel/ExportSACPanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/ExportSACPanel.html#L183">183</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/tools/pannel/ImportWSPanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/ImportWSPanel.html#L243">243</a></td></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/tools/pannel/PlotHelicorderPanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/PlotHelicorderPanel.html#L308">308</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>		}
	}

	public class TimeRangeDocumentListener implements DocumentListener {

		JTextField f;

		public TimeRangeDocumentListener(JTextField f) {
			this.f = f;
		}

		public void insertUpdate(DocumentEvent e) {
			f.setBackground(validateTime() ? Color.white : RED);
		}

		public void removeUpdate(DocumentEvent e) {
			f.setBackground(validateTime() ? Color.white : RED);
		}

		public void changedUpdate(DocumentEvent e) {
		}

		private boolean validateTime() {
			try {
				Time.parseTimeRange(f.getText());
				return true;
			} catch (ParseException ex) {
				return false;
			}
		}
	}
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/cmd/GetSCNLRawCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/cmd/GetSCNLRawCommand.html#L72">72</a></td></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/server/cmd/GetSCNRawCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/cmd/GetSCNRawCommand.html#L68">68</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>							+ &quot; -&gt; &quot; + t2 + &quot; (&quot; + decimalFormat.format(t2 - t1) + &quot;) &quot;, ct.getRunTimeMillis()), channel);

		int totalBytes = 0;
		if (result != null) {
			String hdr = id + &quot; &quot; + (String) result[0] + &quot;\n&quot;;
			int bytes = ((Integer) result[1]).intValue();
			List&lt;?&gt; items = (List&lt;?&gt;) result[2];
			ByteBuffer bb = ByteBuffer.allocate(bytes);
			for (Iterator&lt;?&gt; it = items.iterator(); it.hasNext();) {
				bb.put((byte[]) it.next());
			}
			bb.flip();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L460">460</a></td></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L589">589</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>		try
		{
			String code = tb.toWinstonString();
			ChannelInputOptimizer opt = (ChannelInputOptimizer)channelOptimizers.get(code);
			if (opt == null)
			{
				opt = new ChannelInputOptimizer(code);
				channelOptimizers.put(code, opt);
				double[] span = data.getTimeSpan(code);
				opt.t1 = span[0];
				opt.t2 = span[1];
			}
			
			winston.useDatabase(code);
			double ts = tb.getStartTimeJ2K();
			String date = dateFormat.format(Util.j2KToDate(ts));</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/WWSClient.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/WWSClient.html#L262">262</a></td></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/server/WWSClient.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/WWSClient.html#L365">365</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>        WWSClient winston = new WWSClient(s, p);
        winston.connect();

        String[] chan = c.split(&quot;\\$&quot;);
        String sta = chan[0];
        String comp = chan[1];
        String net = chan[2];
        String loc = chan.length == 4 ? chan[3] : null;

        Wave wave = winston.getWave(sta, comp, net, loc, st, et, false);

        if (wave != null) {
            wave = wave.subset(st, et);</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2015.
          All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
