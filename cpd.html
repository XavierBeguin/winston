<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2015-12-16 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Winston &#x2013; CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20151216" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Winston
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2015-12-16</span>
                  &nbsp;| <span id="projectVersion">Version: 1.3.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="./" title="Winston">Winston</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                          <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                          <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
            <strong>CPD</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD">PMD</a>
            </li>
                      <li class="none">
                          <a href="findbugs.html" title="FindBugs">FindBugs</a>
            </li>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
                      <li class="none">
                          <a href="cobertura/index.html" title="Cobertura Test Coverage">Cobertura Test Coverage</a>
            </li>
                      <li class="none">
                          <a href="javancss.html" title="JavaNCSS Report">JavaNCSS Report</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section">
<h2><a name="CPD_Results"></a>CPD Results</h2>
<p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 5.3.2.</p></div>
<div class="section">
<h2><a name="Duplications"></a>Duplications</h2>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/WWSCommandString.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/WWSCommandString.html#L26">26</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/wwsCmd/WwsCommandString.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/wwsCmd/WwsCommandString.html#L47">47</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>  }

  public String[] getCommandSplits() {
    return commandSplits;
  }

  public String getString(final int i) {
    if (i &gt;= commandSplits.length)
      return null;
    else
      return commandSplits[i];
  }

  public int getInt(final int i) {
    int result = Integer.MIN_VALUE;
    try {
      result = Integer.parseInt(commandSplits[i]);
    } catch (final Exception e) {
    }
    return result;
  }

  public double getDouble(final int i) {
    double result = Double.NaN;
    try {
      result = Double.parseDouble(commandSplits[i]);
    } catch (final Exception e) {
    }
    return result;
  }

  public String getID() {
    if (commandSplits.length &lt; 2)
      return null;
    else
      return commandSplits[1];
  }

  public String getWinstonSCNL() {
    if (commandSplits.length &lt; 6)
      return null;
    else {
      String loc = &quot;&quot;;
      if (!commandSplits[5].equals(&quot;--&quot;))
        loc = &quot;$&quot; + commandSplits[5];
      return commandSplits[2] + &quot;$&quot; + commandSplits[3] + &quot;$&quot; + commandSplits[4] + loc;
    }
  }

  public double getT1(final boolean isScnl) {
    int ofs = 0;
    if (isScnl)
      ofs = 1;
    if (commandSplits.length &lt; 6 + ofs)
      return Double.NaN;
    else
      return getDouble(5 + ofs);
  }

  public double getT2(final boolean isScnl) {
    int ofs = 0;
    if (isScnl)
      ofs = 1;
    if (commandSplits.length &lt; 7 + ofs)
      return Double.NaN;
    else
      return getDouble(6 + ofs);
  }

  public int length() {
    return commandSplits.length;
  }

  public boolean isLegal(final int cnt) {
    return commandSplits.length == cnt;
  }

  public boolean isLegalSCNTT(final int cnt) {
    if (commandSplits.length != cnt)
      return false;

    if (Double.isNaN(getT1(false)) || Double.isNaN(getT2(false)))
      return false;

    return true;
  }

  public boolean isLegalSCNLTT(final int cnt) {
    if (commandSplits.length != cnt)
      return false;

    if (Double.isNaN(getT1(true)) || Double.isNaN(getT2(true)))
      return false;

    return true;
  }

  public String getS() {
    if (commandSplits.length &lt;= 2)
      return null;

    return commandSplits[2];
  }

  public String getC() {
    if (commandSplits.length &lt;= 3)
      return null;

    return commandSplits[3];
  }

  public String getN() {
    if (commandSplits.length &lt;= 4)
      return null;

    return commandSplits[4];
  }

  public String getL() {
    if (commandSplits.length &lt;= 5)
      return null;

    return commandSplits[5];
  }

  // TODO: fix getL() below.
  public String getEarthwormErrorString(final int sid, final String msg) {
    return getID() + &quot; &quot; + sid + &quot; &quot; + getS() + &quot; &quot; + getC() + &quot; &quot; + getN() + &quot; &quot; + getL() + &quot; &quot;
        + msg + &quot;\n&quot;;
  }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/http/HttpMenuCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/http/HttpMenuCommand.html#L104">104</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/httpCmd/HttpMenuCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/httpCmd/HttpMenuCommand.html#L204">204</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    writeSimpleHTML(output.toString());
  }

  private Comparator&lt;String[]&gt; getMenuComparator(final int sortCol, final char order) {
    return new Comparator&lt;String[]&gt;() {
      public int compare(final String[] e1, final String[] e2) {
        // numeric columns
        if (sortCol == 1 || sortCol == 6 || sortCol == 7) {
          final double d1 = Double.parseDouble(e1[sortCol]);
          final double d2 = Double.parseDouble(e2[sortCol]);

          // Do this the hard way to avoid an int overflow.
          // Yes, this bug was encountered in a running system.
          final double d = d1 - d2;
          if (d == 0)
            return 0;

          final int i = (d &lt; 0 ? -1 : 1);

          if (order == 'a')
            return i;
          else
            return -i;
        }
        // textual columns
        else {
          if (order == 'a')
            return e1[sortCol].compareTo(e2[sortCol]);
          else
            return e2[sortCol].compareTo(e1[sortCol]);
        }
      }
    };
  }

  public String getUsage(final HttpRequest req) {
    final String Url = &quot;http://&quot; + req.getHeader(&quot;Host&quot;) + &quot;/menu&quot;;

    final StringBuilder output = new StringBuilder();

    output.append(
        &quot;&lt;script&gt;function buildMenuUrl() {&quot; + &quot;var urlDiv = document.getElementById(\&quot;menuUrl\&quot;);\n&quot;
            + &quot;var menuOB = document.getElementById(\&quot;menuOB\&quot;);\n&quot;
            + &quot;var menuSO = document.getElementById(\&quot;menuSO\&quot;);\n&quot;
            + &quot;var menuTZ = document.getElementById(\&quot;menuTZ\&quot;);\n&quot;
            + &quot;var a = document.createElement('a');\n&quot; + &quot;var linkUrl = \&quot;http://&quot;
            + req.getHeader(&quot;Host&quot;) + &quot;/menu?\&quot;;\n&quot;);

    output.append(
        &quot;if (menuOB.value != \&quot;&quot; + DEFAULT_OB + &quot;\&quot;) { linkUrl += \&quot;&amp;ob=\&quot; + menuOB.value;}\n&quot;);
    output.append(
        &quot;if (menuSO.value != \&quot;&quot; + DEFAULT_SO + &quot;\&quot;) { linkUrl += \&quot;&amp;so=\&quot; + menuSO.value;}\n&quot;);
    output.append(
        &quot;if (menuTZ.value != \&quot;&quot; + DEFAULT_TZ + &quot;\&quot;) { linkUrl += \&quot;&amp;tz=\&quot; + menuTZ.value;}\n&quot;);
    output.append(&quot;linkUrl = linkUrl.replace(\&quot;?&amp;\&quot;, \&quot;?\&quot;);\n&quot;);
    output.append(&quot;linkUrl = linkUrl.replace(/\\?$/, \&quot;\&quot;);\n&quot;);
    output.append(&quot;a.href = linkUrl;\n&quot; + &quot;a.text = linkUrl;\n&quot; + &quot;a.textContent = linkUrl; \n&quot;
        + &quot;a.textContent = linkUrl; \n&quot;
        + &quot;while(urlDiv.hasChildNodes()) {urlDiv.removeChild(urlDiv.lastChild);}&quot;
        + &quot;urlDiv.appendChild(a);\n&quot; + &quot;}&lt;/script&gt;\n&quot;);

    output.append(
        &quot;Returns the server menu. The menu contains the list of stations in this winston along with the earliest and most recent data point for each station.\n&quot;);
    output.append(&quot;&lt;div class=\&quot;tabContentTitle\&quot;&gt;URL Builder&lt;/DIV&gt;\n&quot;);
    output.append(&quot;&lt;div class=\&quot;tabContent\&quot;&gt;\n&quot;);
    output.append(&quot;&lt;FORM&gt;\n&quot;);
    output.append(&quot;&lt;div class=\&quot;left\&quot;&gt;&lt;div class=\&quot;left\&quot;&gt;\n&quot;);
    output.append(&quot;&lt;label for=\&quot;tz\&quot;&gt;Time Zone&lt;/label&gt;&lt;br&gt;\n&quot;);
    output.append(
        &quot;&lt;select onchange=\&quot;buildMenuUrl()\&quot; class=\&quot;timeZone\&quot; id=\&quot;menuTZ\&quot; name=\&quot;tz\&quot; size=8&gt;&quot;
            + &quot;&lt;/select&gt;&quot;);
    output.append(&quot;&lt;/div&gt;&lt;div class=\&quot;right\&quot;&gt;\n&quot;);
    output.append(
        &quot;&lt;br&gt;&lt;div class=\&quot;input\&quot; style=\&quot;width: 20em\&quot;&gt;&lt;label for=\&quot;ob\&quot;&gt;Order By&lt;/label&gt;&quot;);
    output.append(&quot;&lt;select id=\&quot;menuOB\&quot; onchange=\&quot;buildMenuUrl()\&quot; name=\&quot;ob\&quot;&gt;\n&quot;
        + &quot;&lt;option value=1&gt;Pin&lt;/option&gt;&quot; + &quot;&lt;option value=2 selected&gt;Station&lt;/option&gt;&quot;
        + &quot;&lt;option value=3&gt;Component&lt;/option&gt;&quot; + &quot;&lt;option value=4&gt;Network&lt;/option&gt;&quot;
        + &quot;&lt;option value=5&gt;Location&lt;/option&gt;&quot; + &quot;&lt;option value=6&gt;Earliest&lt;/option&gt;&quot;
        + &quot;&lt;option value=7&gt;Most Recent&lt;/option&gt;&quot; + &quot;&lt;option value=8&gt;Type&lt;/Option&gt;&quot;
        + &quot;&lt;/select&gt;&lt;/div&gt;&lt;br&gt;\n&quot;);
    output
        .append(&quot;&lt;div class=\&quot;input\&quot; style=\&quot;width: 20em\&quot;&gt;&lt;label for=\&quot;so\&quot;&gt;Sort Order&lt;/label&gt;&quot;);
    output.append(&quot;&lt;select id=\&quot;menuSO\&quot; onchange=\&quot;buildMenuUrl()\&quot; name=\&quot;so\&quot;&gt;&quot;
        + &quot;&lt;option value=\&quot;a\&quot; selected&gt;Ascending&lt;/option&gt;&quot;
        + &quot;&lt;option value=\&quot;d\&quot;&gt;Descending&lt;/option&gt;&quot; + &quot;&lt;/select&gt;&lt;/div&gt;&lt;br&gt;&quot;);

    output.append(&quot;&lt;/div&gt;&lt;/div&gt;&lt;/FORM&gt;&lt;div class=\&quot;clear\&quot;&gt;&lt;/div&gt;\n&quot;);
    output.append(&quot;&lt;HR class=\&quot;urlBuilder\&quot;&gt;&lt;b&gt;URL:&lt;/b&gt;&lt;BR&gt;&lt;div id=\&quot;menuUrl\&quot;&gt;&lt;/div&gt;&quot;);
    output.append(&quot;&lt;/div&gt;&quot;);
    output.append(&quot;&lt;div class=\&quot;tabContentTitle\&quot;&gt;Arguments&lt;/DIV&gt;\n&quot;);
    output.append(&quot;&lt;div class=\&quot;tabContent\&quot;&gt;\n&quot;);
    output.append(
        &quot;&lt;code&gt;ob&lt;/code&gt;: &lt;b&gt;Order By&lt;/b&gt; The column number used to order the menu (default = &quot;
            + DEFAULT_OB + &quot;).&lt;br&gt;&lt;br&gt;\n&quot;
            + &quot;&lt;code&gt;so&lt;/code&gt;: &lt;b&gt;Sort Order&lt;/b&gt; How to order the menu, a is ascending, d is decending (default = &quot;
            + DEFAULT_SO + &quot;).&lt;br&gt;&lt;br&gt;\n&quot; + &quot;&lt;code&gt;tz&lt;/code&gt;: &lt;b&gt;Time Zone&lt;/b&gt; (deafult = &quot;
            + DEFAULT_TZ + &quot;)&lt;br&gt;&lt;br&gt;\n&quot;);
    output.append(&quot;&lt;/div&gt;&quot;);
    output.append(&quot;&lt;div class=\&quot;tabContentTitle\&quot;&gt;Examples&lt;/DIV&gt;\n&quot;);
    output.append(&quot;&lt;div class=\&quot;tabContent\&quot;&gt;\n&quot;);
    output.append(&quot;Most recently added channels:&lt;br&gt;&lt;a href=\&quot;http://&quot; + req.getHeader(&quot;Host&quot;)
        + &quot;/menu?ob=6&amp;so=d\&quot;&gt;&quot; + &quot;http://&quot; + req.getHeader(&quot;Host&quot;)
        + &quot;/menu?ob=6&amp;so=d&lt;/a&gt;&lt;br&gt;&lt;p&gt;&lt;br&gt;&quot;);
    output.append(&quot;Channels with least recent data:&lt;br&gt;&lt;a href=\&quot;http://&quot; + req.getHeader(&quot;Host&quot;)
        + &quot;/menu?ob=7&amp;so=a\&quot;&gt;&quot; + &quot;http://&quot; + req.getHeader(&quot;Host&quot;) + &quot;/menu?ob=7&amp;so=a&lt;/a&gt;&lt;p&gt;&quot;);
    output.append(&quot;&lt;/div&gt;&quot;);
    return output.toString();
  }

  public String getAnchor() {
    return &quot;menu&quot;;
  }

  public String getTitle() {
    return &quot;Server Menu&quot;;
  }

  @Override
  public String getCommand() {
    return &quot;/menu&quot;;
  }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/http/AbstractHttpCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/http/AbstractHttpCommand.html#L124">124</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/httpCmd/HttpBaseCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/httpCmd/HttpBaseCommand.html#L141">141</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>  }

  /**
   * 
   * @param t1
   *          start time String
   * @param endTime
   *          end time
   * @param mult
   *          number of seconds per interval used for relative times. 60 for
   *          minutes, 60*60 for hours, 60*60*24 for days
   * @return
   * @throws ParseException
   */
  protected Double getStartTime(final String t1, final Double endTime, final long mult) {
    Double startTime = Double.NaN;

    if (t1 == null || t1.substring(0, 1).equals(&quot;-&quot;)) {
      final double hrs = StringUtils.stringToDouble(t1, -12);
      startTime = endTime + hrs * mult;
    } else {
      final DateFormat dateFormat = new SimpleDateFormat(INPUT_DATE_FORMAT);
      dateFormat.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));
      Date bt;
      try {
        bt = dateFormat.parse(t1);
        startTime = J2kSec.fromDate(bt);
      } catch (final ParseException e) {
        startTime = Double.NaN;
      }
    }

    return timeOrMaxDays(startTime);
  }

  /*
   * convert time back to UTC
   */
  protected Double getStartTime(final String t1, final Double endTime, final long mult,
      final TimeZone tz) {
    final double startTime = getStartTime(t1, endTime, mult);
    return timeOrMaxDays(startTime - (tz.getOffset(J2kSec.asEpoch(endTime))));
  }

  /**
   * parse end time
   * 
   * @param t2
   * @return
   */
  protected Double getEndTime(final String t2) {
    Double endTime = Double.NaN;
    if (t2 == null || t2.equalsIgnoreCase(&quot;now&quot;))
      endTime = J2kSec.now();
    else {
      final DateFormat dateFormat = new SimpleDateFormat(INPUT_DATE_FORMAT);
      dateFormat.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));
      Date bt;
      try {
        bt = dateFormat.parse(t2);
        endTime = J2kSec.fromDate(bt) - 1;
      } catch (final ParseException e) {
        endTime = Double.NaN;
      }
    }

    return timeOrMaxDays(endTime);
  }

  /**
   * convert back to UTC
   * 
   */
  protected Double getEndTime(final String t2, final TimeZone tz) {
    final Double endTime = getEndTime(t2);
    return timeOrMaxDays(endTime - (tz.getOffset(J2kSec.asEpoch(endTime))));
  }

  /**
   * Apply maxDays to time
   * 
   * @param t
   *          time
   * @return greater of t or now less maxDays
   */
  protected double timeOrMaxDays(final double t) {
    if (maxDays == 0)
      return t;
    else
      return Math.max(t, J2kSec.now() - (maxDays * ONE_DAY));
  }

  /**
   * Convert a boolean value to an integer as passed in arguments.
   * 
   * @param in
   * @return
   */
  protected int boolToInt(final boolean in) {
    return in == true ? 1 : 0;
  }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L348">348</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L466">466</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>          if (!filled) {
            d = new double[] {i, Integer.MAX_VALUE, Integer.MIN_VALUE, 0, 0};
            winston.getStatement().execute(&quot;INSERT IGNORE INTO `&quot; + table + &quot;` VALUES (&quot; + i + &quot;,&quot;
                + Integer.MAX_VALUE + &quot;,&quot; + Integer.MIN_VALUE + &quot;,0,0)&quot;);
          }
        }
        heliList[j++] = d;
      }
      double st = tb.getStartTimeJ2K();
      final double dt = 1 / tb.samplingRate();
      for (int i = 0; i &lt; tb.numSamples(); i++) {
        j = (int) (Math.floor(st) - fst);
        final double[] d = heliList[j];
        final int sample = tb.samples()[i];
        d[1] = Math.min(d[1], sample);
        d[2] = Math.max(d[2], sample);
        d[4] = (d[4] * d[3] + Math.abs(sample)) / (d[3] + 1);
        d[3] = d[3] + 1;
        st += dt;
      }

      for (int i = 0; i &lt; heliList.length; i++) {
        final int j2k = (int) Math.round(fst + i);
        winston.getStatement()
            .execute(&quot;UPDATE `&quot; + table + &quot;` SET smin=&quot; + (int) heliList[i][1] + &quot;, smax=&quot;
                + (int) heliList[i][2] + &quot;, rcnt=&quot; + (int) heliList[i][3] + &quot;, rsam=&quot;
                + heliList[i][4] + &quot; WHERE j2ksec=&quot; + j2k);
        opt.putData(j2k, heliList[i]);
      }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/http/HttpMenuCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/http/HttpMenuCommand.html#L70">70</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/httpCmd/HttpMenuCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/httpCmd/HttpMenuCommand.html#L169">169</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    final List&lt;String&gt; list = emulator.getWaveServerMenu(true, 0, 0, maxDays);
    final String[][] menu = new String[list.size()][8];
    int i = 0;
    for (final String s : list)
      menu[i++] = s.split(&quot;\\s&quot;);

    Arrays.sort(menu, getMenuComparator(sortCol, order));

    // display menu items
    for (final String[] line : menu) {
      if (line.length &lt; 8) {
        output.append(&quot;can't parse line, skipping. &quot; + Arrays.toString(line));
        continue;
      }

      SimpleDateFormat dateF = new SimpleDateFormat(Time.STANDARD_TIME_FORMAT);
      dateF.setTimeZone(timeZone);
      
      final double start = Double.parseDouble(line[6]);
      final double end = Double.parseDouble(line[7]);

      output.append(&quot;&lt;tr&gt;&quot;);
      output.append(&quot;&lt;td&gt;&quot; + line[1] + &quot;&lt;/td&gt;&quot;);
      output.append(&quot;&lt;td&gt;&quot; + line[2] + &quot;&lt;/td&gt;&quot;);
      output.append(&quot;&lt;td&gt;&quot; + line[3] + &quot;&lt;/td&gt;&quot;);
      output.append(&quot;&lt;td&gt;&quot; + line[4] + &quot;&lt;/td&gt;&quot;);
      output.append(&quot;&lt;td&gt;&quot; + line[5] + &quot;&lt;/td&gt;&quot;);
      output.append(&quot;&lt;td&gt;&quot; + dateF.format(Ew.asEpoch(start)) + &quot;&lt;/td&gt;&quot;);
      output.append(&quot;&lt;td&gt;&quot; + dateF.format(Ew.asEpoch(end)) + &quot;&lt;/td&gt;&quot;);
      output.append(&quot;&lt;td&gt;&quot; + line[8] + &quot;&lt;/td&gt;&quot;);
      output.append(&quot;&lt;/tr&gt;\n&quot;);
    }

    output.append(&quot;&lt;/table&gt;&quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/BaseCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/BaseCommand.html#L130">130</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/wwsCmd/WwsBaseCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/wwsCmd/WwsBaseCommand.html#L166">166</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>      ct += dt;
    }
    sts = numberFormat.format(Ew.fromEpoch(J2kSec.asEpoch(ct)));
    final ByteBuffer bb = ByteBuffer.allocate(wave.numSamples() * 13 + 256);
    bb.put(id.getBytes());
    bb.put((byte) ' ');
    bb.put(Integer.toString(sid).getBytes());
    bb.put((byte) ' ');
    bb.put(s.getBytes());
    bb.put((byte) ' ');
    bb.put(c.getBytes());
    bb.put((byte) ' ');
    bb.put(n.getBytes());
    if (l != null) {
      bb.put((byte) ' ');
      bb.put(l.getBytes());
    }
    bb.put(&quot; F s4 &quot;.getBytes());
    bb.put(sts.getBytes());
    bb.put((byte) ' ');
    bb.put(Double.toString(wave.getSamplingRate()).getBytes());
    bb.put(&quot; &quot;.getBytes());
    int sample;
    ct = wave.getStartTime();
    // int samples = 0;
    for (int i = 0; i &lt; wave.numSamples(); i++) {
      if (ct &gt;= (t1 - dt / 2)) {
        // samples++;
        sample = wave.buffer[i];
        if (sample == Wave.NO_DATA)</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/tools/pannel/AdminPanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/AdminPanel.html#L36">36</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/tools/pannel/WinstonUpgradePanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/WinstonUpgradePanel.html#L37">37</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>        &quot;Winston Admin&quot;));
    setLayout(new BoxLayout(this, BoxLayout.PAGE_AXIS));

    final FormLayout layout = new FormLayout(&quot;left:p, 4dlu, fill:p:G&quot;, &quot;&quot;);

    final DefaultFormBuilder builder = new DefaultFormBuilder(layout);
    builder.setDefaultDialogBorder();

    createFields();
    builder.append(&quot;Current schema&quot;, currentVersion);
    builder.nextLine();
    builder.append(&quot;Available upgrade&quot;, upgradeDescription);
    builder.nextLine();
    builder.appendUnrelatedComponentsGapRow();
    builder.nextLine();
    builder.append(&quot;&quot;, upgradeB);
    add(builder.getPanel());
  }

  @Override
  protected void createFields() {
    ug = new Upgrade();

    currentVersion = new JTextField(ug.getCurrentVersion());

    upgradeDescription = new JTextArea(ug.getUpgraderDescription());
    upgradeDescription.setLineWrap(true);
    upgradeDescription.setWrapStyleWord(true);

    upgradeB = new JButton(&quot;upgrade&quot;);
    upgradeB.setEnabled(ug.upgradeAvailable());
    upgradeB.addActionListener(new ActionListener() {
      public void actionPerformed(final ActionEvent e) {
        start();
      }
    });
  }

  @Override
  protected void go() {
    ug.doUpgrade();
    removeAll();
    createUI();
  }

  @Override
  public boolean needsWinston() {
    return true;
  }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L315">315</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L440">440</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>      opt.t1 = Math.min(opt.t1, tb.getStartTimeJ2K());
      opt.t2 = Math.max(opt.t2, tb.getEndTimeJ2K());

      if (!writeLocks) {
        setTimeSpan(code, opt.t1, opt.t2);
        // setTimeSpan(code, opt.t1, opt.t2);
      }

      /// ----- now insert/update helicorder/rsam data
      table = code + &quot;$$H&quot; + date;
      final double fst = Math.floor(tb.getStartTimeJ2K());
      final double cet = Math.ceil(tb.getEndTimeJ2K());
      final double[][] heliList = new double[((int) Math.round(cet - fst)) + 1][];
      int j = 0;
      for (int i = (int) Math.round(fst); i &lt;= (int) Math.round(cet); i++) {
        double[] d = opt.getData(i);
        if (d == null) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L564">564</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/db/InputEW.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/InputEW.html#L556">556</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>          checkTableCache.remove(table);

          winston.getStatement().execute(&quot;DROP TABLE `&quot; + table + &quot;`&quot;);
          winston.getStatement().execute(&quot;DROP TABLE `&quot; + ss[0] + &quot;$$H&quot; + ss[1] + &quot;`&quot;);
          deleted = true;
          LOGGER.info(&quot;Deleted table: {}&quot;, table);
        } catch (final Exception e) {
          LOGGER.error(&quot;Could not drop old table: {}.  Are permissions set properly?&quot;, channel);
        }
      } else {
        if (deleted) {
          try {
            final String nextLowestTable = table;
            final ResultSet rs = winston.getStatement()
                .executeQuery(&quot;SELECT MIN(st) FROM `&quot; + nextLowestTable + &quot;`&quot;);
            rs.next();
            final double t1 = rs.getDouble(1);
            setTimeSpan(channel, t1, Double.NaN);
            rs.close();
            setTime = true;
          } catch (final Exception e) {
            LOGGER.error(&quot;Could not update span after dropping table: &quot;, channel);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/WWS.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/WWS.html#L90">90</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/WWS.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/WWS.html#L93">93</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>  }

  public static void printKeys() {
    final StringBuffer sb = new StringBuffer();
    sb.append(Version.VERSION_STRING + &quot;\n&quot;);
    sb.append(&quot;Keys:\n&quot;);
    sb.append(&quot; 0-3: logging level\n&quot;);
    sb.append(&quot;        d: drop idle connections\n&quot;);
    sb.append(&quot;        q: quit\n&quot;);
    sb.append(&quot;        ?: display keys\n&quot;);
    sb.append(&quot;        m: print running commands\n&quot;);
    sb.append(&quot; t&lt;index&gt;: toggle tracing of a connection\n&quot;);
    sb.append(&quot;        c: print connections sorted by bytes transmited\n&quot;);
    sb.append(&quot;       cA: print connections sorted by address\n&quot;);
    sb.append(&quot;       cC: print connections sorted by connect time\n&quot;);
    sb.append(&quot;       cL: print connections sorted by last request time\n&quot;);
    sb.append(&quot;       cR: print connections sorted by bytes received\n&quot;);
    sb.append(&quot;       cT: print connections sorted by bytes transmited\n&quot;);
    sb.append(&quot;       cI: print connections sorted by index\n&quot;);
    sb.append(&quot;         : append '-' to sort in descending order.\n&quot;);

    System.out.println(sb);
  }

  protected boolean allowHttp;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/http/HttpMenuCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/http/HttpMenuCommand.html#L52">52</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/httpCmd/HttpMenuCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/httpCmd/HttpMenuCommand.html#L148">148</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    final String[] colTitle = {null, &quot;Pin&quot;, &quot;S&quot;, &quot;C&quot;, &quot;N&quot;, &quot;L&quot;, &quot;Earliest&quot;, &quot;Most Recent&quot;, &quot;Type&quot;};
    colTitle[sortCol] += order == 'a' ? &quot; &amp;#9652;&quot; : &quot; &amp;#9662;&quot;;

    final char[] colOrd = new char[colTitle.length];
    Arrays.fill(colOrd, 'a');
    if (order == 'a')
      colOrd[sortCol] = 'd';

    final StringBuilder output = new StringBuilder();

    output.append(&quot;&lt;table CELLPADDING=\&quot;5\&quot;&gt;&lt;tr&gt;&quot;);
    for (int i = 1; i &lt; colTitle.length; i++)
      output.append(
          &quot;&lt;th&gt;&lt;a href=\&quot;?ob=&quot; + i + &quot;&amp;so=&quot; + colOrd[i] + &quot;\&quot;&gt;&quot; + colTitle[i] + &quot;&lt;/a&gt;&lt;/th&gt;&quot;);

    output.append(&quot;&lt;/tr&gt;&quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/GetSCNCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/GetSCNCommand.html#L40">40</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/GetSCNLCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/GetSCNLCommand.html#L44">44</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    double t2 = Time.ewToj2k(cmd.getT2(false));
    t2 = timeOrMaxDays(t2);

    final double[] bounds = checkTimes(sid, t1, t2);
    if (!allowTransaction(bounds)) {
      netTools.writeString(cmd.getEarthwormErrorString(sid, getError(bounds)), channel);
      return;
    }
    Wave wave = null;
    try {
      wave = data.getWave(sid, t1, t2, 0);
    } catch (final UtilException e) {
    }
    if (wave != null)
      totalBytes = writeWaveAsAscii(wave, sid, cmd.getID(), cmd.getS(), cmd.getC(), cmd.getN(),</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/tools/pannel/ExportSACPanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/ExportSACPanel.html#L184">184</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/tools/pannel/ImportWSPanel.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/tools/pannel/ImportWSPanel.html#L247">247</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    }
  }

  public class TimeRangeDocumentListener implements DocumentListener {

    JTextField f;

    public TimeRangeDocumentListener(final JTextField f) {
      this.f = f;
    }

    public void insertUpdate(final DocumentEvent e) {
      f.setBackground(validateTime() ? Color.white : RED);
    }

    public void removeUpdate(final DocumentEvent e) {
      f.setBackground(validateTime() ? Color.white : RED);
    }

    public void changedUpdate(final DocumentEvent e) {}

    private boolean validateTime() {
      try {
        Time.parseTimeRange(f.getText());
        return true;
      } catch (final ParseException ex) {
        return false;
      }
    }
  }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/BaseCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/BaseCommand.html#L118">118</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/wwsCmd/WwsBaseCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/wwsCmd/WwsBaseCommand.html#L153">153</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>  public int writeWaveAsAscii(final Wave wave, final int sid, final String id, final String s,
      final String c, final String n, final String l, final double t1, final double t2,
      final String fill, final SocketChannel channel) {
    final NumberFormat numberFormat = new DecimalFormat(&quot;#.######&quot;);
    String sts = null;

    // find first sample time
    double ct = wave.getStartTime() - wave.getRegistrationOffset();
    final double dt = 1 / wave.getSamplingRate();
    for (int i = 0; i &lt; wave.numSamples(); i++) {
      if (ct &gt;= (t1 - dt / 2))</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/GetSCNLRawCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/GetSCNLRawCommand.html#L77">77</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/legacyServer/cmd/GetSCNRawCommand.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/cmd/GetSCNRawCommand.html#L68">68</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>          channel);

    int totalBytes = 0;
    if (result != null) {
      final String hdr = id + &quot; &quot; + (String) result[0] + &quot;\n&quot;;
      final int bytes = ((Integer) result[1]).intValue();
      final List&lt;?&gt; items = (List&lt;?&gt;) result[2];
      final ByteBuffer bb = ByteBuffer.allocate(bytes);
      for (final Iterator&lt;?&gt; it = items.iterator(); it.hasNext();) {
        bb.put((byte[]) it.next());
      }
      bb.flip();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/WWSClient.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/WWSClient.html#L283">283</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/legacyServer/WWSClient.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/WWSClient.html#L354">354</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    Wave wave = winston.getWave(sta, comp, net, loc, st, et, false);

    if (wave != null) {
      wave = wave.subset(st, et);

      final SeismicDataFile file = SeismicDataFile.getFile(fn, FileType.SAC);
      String channel = sta + &quot;_&quot; + comp + &quot;_&quot; + net;
      if (loc != null)
        channel += &quot;_&quot; + loc;

      file.putWave(channel, wave);
      try {
        file.write();
      } catch (final IOException e) {
        System.err.println(&quot;Couldn't write file: &quot; + e.getLocalizedMessage());
        e.printStackTrace();
      }
    } else {
      System.out.println(&quot;Wave not found&quot;);
    }
  }

  public static void outputSac(final String server, final int port, final Double st,</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/WWS.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/WWS.html#L158">158</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/server/WWS.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/server/WWS.html#L163">163</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    logger.severe(msg);
    System.exit(1);
  }

  public int getEmbargo() {
    return embargo;
  }

  public int getMaxDays() {
    return maxDays;
  }

  public int getSlowCommandTime() {
    return slowCommandTime;
  }

  /**
   * Get the Winston database driver.
   *
   * @return the Winston database driver.
   */
  public String getWinstonDriver() {
    return winstonDriver;
  }

  public String getWinstonPrefix() {
    return winstonPrefix;
  }

  public int getWinstonStatementCacheCap() {
    return winstonStatementCacheCap;
  }

  /**
   * Gets the Winston database JDBC URL.
   *
   * @return the Winston database URL
   */
  public String getWinstonURL() {
    return winstonURL;
  }

  public int httpMaxSize() {
    return httpMaxSize;
  }

  public int httpRefreshInterval() {
    return httpRefreshInterval;
  }

  public boolean isHttpAllowed() {
    return allowHttp;
  }

  public void launch() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/legacyServer/WWSClient.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/WWSClient.html#L274">274</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/legacyServer/WWSClient.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/legacyServer/WWSClient.html#L379">379</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    final WWSClient winston = new WWSClient(s, p);
    winston.connect();

    final String[] chan = c.split(&quot;\\$&quot;);
    final String sta = chan[0];
    final String comp = chan[1];
    final String net = chan[2];
    final String loc = chan.length == 4 ? chan[3] : null;

    Wave wave = winston.getWave(sta, comp, net, loc, st, et, false);

    if (wave != null) {
      wave = wave.subset(st, et);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L271">271</a></td></tr>
<tr class="a">
<td>gov/usgs/volcanoes/winston/db/Input.java</td>
<td><a href="./xref/gov/usgs/volcanoes/winston/db/Input.html#L398">398</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    try {
      final String code = tb.toWinstonString();
      ChannelInputOptimizer opt = channelOptimizers.get(code);
      if (opt == null) {
        opt = new ChannelInputOptimizer(code);
        channelOptimizers.put(code, opt);
        final double[] span = data.getTimeSpan(code);
        opt.t1 = span[0];
        opt.t2 = span[1];
      }

      winston.useDatabase(code);
      final double ts = tb.getStartTimeJ2K();
      final String date = dateFormat.format(J2kSec.asDate(ts));</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2015.
          All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
